@using AdvantShop.CMS
@model AdvantShop.Web.Admin.Models.Catalog.Products.AdminProductModel
@{
    var isMobile = SettingsDesign.IsMobileTemplate;
}
<aside class="product-aside-right">
    <div class="ibox margin-none">
        <div class="ibox-content product-setting-aside-block">
            @if (Model.ShowMarketplaceProductButton)
            {
                <div class="setting-label-wrap form-group form-control-title">
                    <div class="form-control-wrap">
                        <span class="@(isMobile ? "flex-grow" : "")">@T("Admin.Product.RightBlock.Marketplace.Header")</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="flex">
                        @Html.RenderMarketplaceButtons(Model.ProductId, isAdminPart: true)
                    </div>
                </div>
            }

            @Html.RenderModules("admin_product_rightblock_top", new { productId = Model.ProductId })

            <div class="setting-label-wrap form-group form-control-title">
                <div class="form-control-wrap">
                    <span class="@(isMobile ? "flex-grow" : "")">@T("Admin.Product.RightBlock.Manufacturer")</span>
                    <help-trigger class="ng-cloak m-l-xs" data-title="@T("Admin.Product.RightBlock.Manufacturer")">
                        <p>@T("Admin.Product.RightBlock.ProductsOfWellknown")</p>
                        <p>@T("Admin.Product.RightBlock.SpecifyManufacturer")</p>
                        <p>@T("Admin.Product.RightBlock.MoreAboutManufacturers")</p>
                        <p>
                            <a href="http://www.advantshop.net/help/pages/brand" target="_blank">@T("Admin.Product.RightBlock.Instruction")</a>
                        </p>
                    </help-trigger>
                </div>
            </div>
            <div class="form-group"
                 ng-init="product.brand='@Html.AttributeEncode(Model.Brand != null ? Model.Brand.Name : T("Admin.Product.Edit.NotSelect").ToString())'; product.brandId=@(Model.Brand != null ? Model.Brand.BrandId : 0)">
                <span ng-bind-html="product.brand" data-e2e="ProductBrandName" class="vertical-middle">@Html.Raw(Model.Brand != null ? Model.Brand.Name : T("Admin.Product.Edit.NotSelect").ToString())</span>
                <a class="link-invert link-decoration-none fas fa-times vertical-middle" ng-click="product.deleteBrand()" ng-if="product.brandId != 0" href="" title="@T("Admin.Product.RightBlock.Delete")" data-e2e="DeleteBrand"></a>
                <ui-modal-trigger class="vertical-middle" data-controller="'ModalAddBrandCtrl'" controller-as="ctrl"
                                  template-url="@Html.GetAssetPath("addBrand.html")"
                                  data-on-close="product.changeBrand(result)">
                    <a href="" data-e2e="AddBrand">@T("Admin.Choose")</a>
                </ui-modal-trigger>
            </div>

            @if (Model.IsTagsVisible)
            {
                <div class="setting-label-wrap form-group form-control-title">
                    <div class="@(isMobile ? "flex middle-xs" : "")">
                        <span class="@(isMobile ? "flex-grow" : "")">@T("Admin.Product.Edit.Tags")</span>
                        <help-trigger class="ng-cloak m-l-xs" data-title="@T("Admin.Product.Edit.Tags")">
                            <p>@T("Admin.Product.Edit.HelpOfTags")</p>
                            <p>
                                @T("Admin.Product.Edit.Instruction")<a href="http://www.advantshop.net/help/pages/tags" target="_blank">@T("Admin.Product.Edit.TagsMechanism")</a>
                            </p>
                        </help-trigger>
                    </div>
                </div>
                <div class="form-group ng-cloak">
                    <ui-select class="input-alt tag-container"
                               skip-focusser="true"
                               multiple
                               tagging="product.tagTransform"
                               sortable="true"
                               ng-init="product.getTags()"
                               ng-click="product.getTagsByPaging(1000)"
                               ng-model="product.selectedTags"
                               close-on-select="false"
                               data-e2e="SelectTag">
                        <ui-select-match placeholder="@T("Admin.Product.Edit.SelectTags")">{{$item.value}}</ui-select-match>
                        <ui-select-choices repeat="tag in product.tags | filter:$select.search"
                                           minimum-input-length="1"
                                           refresh="product.getTagsByPaging(250, $select.search)"
                                           refresh-delay="0">
                            {{tag.value}}
                        </ui-select-choices>
                    </ui-select>
                    @*select для отправки данных через обычный post *@
                    <select name="Tags" id="Tags" multiple hidden>
                        <option selected value="{{option.value}}" ng-repeat="option in product.selectedTags track by $index"></option>
                    </select>
                </div>
            }
            <div>
                <div class="@(isMobile ? "flex" : "info-about-product-row")">
                    <div class="info-about-product-cell">
                        @T("Admin.Product.Edit.Reviews")
                    </div>
                    <div class="info-about-product-cell info-about-product-cell--pad-l @(isMobile ? "p-l-xs" : "")" data-e2e="ProductReviewsCount">
                        @Model.ReviewsCount
                        @if (Model.ReviewsCount > 0)
                        {
                            <a href="@Url.AbsoluteActionUrl("Index", "Reviews", new {EntityId = Model.ProductId, Type = EntityType.Product})" class="italic" target="_blank" data-e2e="Review">@T("Admin.Product.Edit.View")</a>
                        }
                    </div>
                </div>
            </div>

            <div class="info-about-product">
                <div class="info-about-product-row">
                    <div class="info-about-product-cell">
                        @T("Admin.Product.Edit.SortPopular"): @Model.SortPopular
                    </div>
                </div>
                <div class="info-about-product-row">
                    <a href="@Url.AbsoluteActionUrl("Index", "Analytics", new {productId = Model.ProductId})" data-e2e="Sales" @(isMobile ? "" : "target=\"_blank\"")>@T("Admin.Product.Edit.SalesGraph")</a>
                </div>
            </div>

            <div class="info-about-product-row ng-cloak" ng-if="product.ModifiedDate != null || product.ModifiedBy != null">
                <div>
                    @T("Admin.Product.Edit.Changed")
                    <span class="m-b-xs @(isMobile ? "" : "inline-block")">
                        {{::product.ModifiedDate}} {{::product.ModifiedBy}}
                    </span>
                </div>
            </div>

            @if (SettingsMain.TrackProductChanges)
            {
                <ui-modal-trigger size="xs-9"
                                  data-controller="'ModalChangeHistoryCtrl'"
                                  controller-as="ctrl"
                                  template-url="@Html.GetAssetPath("changeHistory.html")"
                                  data-resolve="{'params': {'objId': @Model.ProductId, 'type': 'product'}}">
                    <a class="" href="">@T("Admin.Product.RightBlock.HistoryChanges")</a>
                </ui-modal-trigger>
            }
            @Html.RenderModules("admin_product_rightblock_bottom", new { productId = Model.ProductId })
        </div>
    </div>
    @if (!isMobile)
    {
        <div class="product-aside-right-footer">
            <ui-modal-trigger data-controller="'ModalCopyProductCtrl'" controller-as="ctrl"
                              template-url="@Html.GetAssetPath("CopyProduct.html")"
                              data-resolve="{ 'product': { 'productId': @Model.ProductId, 'name': product.Name }}">
                <a href="" data-e2e="ProductCopy">@T("Admin.Product.Edit.MakeCopyOfItem")</a>
            </ui-modal-trigger>
        </div>
    }
</aside>