@model AdvantShop.Web.Admin.Models.Cms.News.AddEditNewsModel
@{
    var isMobile = SettingsDesign.IsMobileTemplate;
    if (!isMobile)
    {
        Layout = "~/Areas/Admin/Views/Store/_StoreLayout.cshtml";
    }
    Html.AddAsset("news");
}


<form method="POST" action="@(Model.IsEditMode ? Url.AbsoluteActionUrl("Edit") : Url.AbsoluteActionUrl("Add"))" enctype="multipart/form-data" novalidate="novalidate" name="form">
    @Html.AntiForgeryToken()
    @Html.HiddenFor(x => Model.NewsId)
    @Html.HiddenFor(x => Model.IsEditMode)

    @if (isMobile)
    {
        var headerModel = new AdvantShop.Web.Admin.ViewModels.Shared.Common.HeaderViewModel();

        headerModel.Controls = new List<IButton>();
        headerModel.Title = Model.IsEditMode ? T("Admin.News.AddEdit.News").ToString() : T("Admin.News.AddEdit.NewNews").ToString();
        headerModel.Back = new AdvantShop.Web.Admin.ViewModels.Shared.Common.BackViewModel()
        {
            Url = Url.AbsoluteActionUrl("Index", "News")
        };


        headerModel.Controls.Add(
             new ButtonModel()
             {
                 Text = @T("Admin.Settings.Common.Save"),
                 Validation = false,
                 Attributes = new string[] { "ng-disabled=\"!form.modified\"", "disabled" },
                 Type = eButtonType.Save,
                 Modificators = new List<eButtonModificators>()
                    {
                    eButtonModificators.OnlyIcon
                            },
                 Icon = new ButtonIcon()
                 {
                     SvgName = "done",
                     Attributes = new { width = 25, height = 25 }
                 }
             });

        @Html.Header(headerModel)
    }
    else
    {
        @Html.Back(T("Admin.News.Index.Title").ToString(), Url.AbsoluteActionUrl("Index", "News"))

        <div class="m-t-xs m-b sticky-page-name" sticky sticky-top="0">
            <div class="page-name-block sticky-page-name-inner">
                <div class="page-name-block-item-main">
                    <h2 class="m-t-none m-b-none page-name-block-text sticky-page-name-text">
                        @if (Model.IsEditMode)
                        {
                            <span>@T("Admin.News.AddEdit.News")</span>
                            <span>"@Html.Raw(Model.Title)"</span>
                        }
                        else
                        {
                            @T("Admin.News.AddEdit.NewNews")
                        }
                    </h2>
                </div>
                <div class="page-name-block-item-additional">
                    <a href="" class="link-danger m-r-xs" ng-if="@Model.IsEditMode.ToString().ToLower()" ng-click="newsItem.deleteNewsItem(@Model.NewsId)">@T("Admin.News.AddEdit.Delete")</a>
                    @if (Model.IsEditMode && Model.Enabled)
                    {
                        @Html.Button(T("Admin.View"), eButtonType.Simple, eButtonSize.Small, eColorType.Default, @Url.AbsoluteRouteUrl("News", new { url = Model.UrlPath }), name: "ViewNews", attributes: new[] { "target=\"_blank\"" })
                    }

                    @Html.Button(T("Admin.Save"), eButtonType.Save, eButtonSize.Small, eColorType.Success, attributes: new[] { "ng-disabled=\"!form.modified\"", "disabled" })
                </div>
            </div>
        </div>
    }

    <div class="row">
        <div class="col-xs-12">
            <div class="row setting">
                <div class="flex-grow-n @(isMobile ? "col-xs-12" : "col-fixed-size-md")">
                    <h2 class="fs-lg setting__subtitle m-t-none">@T("Admin.News.AddEdit.Main")</h2>
                    <div class="">
                    </div>
                </div>
                <div class="flex-grow flex-basis-n flex-width-n setting__form-group">
                    <div class="ibox category-block">
                        <div class="ibox-content category-content border_none">
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="row category-row form-group setting__form-group middle-xs">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="Title" class="form-label-block control-label">
                                            <span class="text-required">@T("Admin.News.AddEdit.TitleNews")</span>
                                        </label>
                                    </div>
                                    <div class="col-xs-12 col-md-10">
                                        @Html.TextBoxFor(x => x.Title, new { @class = "form-control input-alt-mobile", url_generator = "", url_generator_enabled = Model.UrlPath.IsNotEmpty() ? "false" : "true", url_path = "newsItem.UrlPath", required = "required", ng_model = "newsItem.Title", validation_input_text = T("Admin.News.AddEdit.TitleNews").ToString(), data_e2e="NewsTitle" })
                                    </div>
                                </div>
                            </div>

                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="form-group setting__form-group">
                                    <div class="row middle-xs @(isMobile ? "" : "control-label")">
                                        @if (!isMobile)
                                        {
                                            <div class="col-xs-slim col-sm-2">
                                                <label for="ShowOnMainPage" class="form-label-block">@T("Admin.News.AddEdit.ShowInMainPage")</label>
                                            </div>
                                        }
                                        <div class="relative col-xs-slim relative flex middle-xs first-xs last-sm">
                                            <label class="adv-checkbox-label form-label-block flex" data-e2e="NewsShowOnMainPageLbl">
                                                @Html.CheckBoxFor(x => x.ShowOnMainPage, new { ng_model = "newsItem.showOnMainPage", @class = "adv-checkbox-input", data_e2e="NewsShowOnMainPageChb" })
                                                <span class="adv-checkbox-emul"></span>
                                                @if (isMobile)
                                                {
                                                    <span class="flex-grow m-l-xs">@T("Admin.News.AddEdit.ShowInMainPage")</span>
                                                }
                                             </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="form-group setting__form-group">
                                    <div class="row middle-xs @(isMobile ? "" : "control-label")">
                                        @if (!isMobile)
                                        {
                                            <div class="col-xs-slim col-sm-2">
                                                <label for="newsActivity" class="form-label-block">@T("Admin.News.AddEdit.Activity")</label>
                                            </div>
                                        }
                                        <div class="relative col-xs-slim relative flex middle-xs first-xs last-sm">
                                            <label class="adv-checkbox-label form-label-block flex" data-e2e="NewsEnabledLbl">
                                                @Html.CheckBoxFor(x => x.Enabled, new { id = "newsActivity", ng_model = "newsItem.enabled", @class = "adv-checkbox-input", data_e2e="NewsEnabledChb" })
                                                <span class="adv-checkbox-emul"></span>
                                                @if (isMobile)
                                                {
                                                    <span class="flex-grow m-l-xs">@T("Admin.News.AddEdit.Activity")</span>
                                                }
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="form-group middle-xs row setting__form-group">
                                    <div class="col-xs-12 col-md-2">
                                        <div class="setting-label-wrap">
                                            <label for="NewsCategorys" class="@(isMobile ? "" : "control-label")">
                                                <span class="text-required">@T("Admin.News.AddEdit.NewsCategory")</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-3 col-wl-2">
                                        @Html.DropDownListFor(x => x.NewsCategoryId, Model.NewsCategory, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.newsCategoryId", ng_init = "newsItem.newsCategoryId='" + Model.NewsCategoryId + "'", required = "required", validation_input_text = T("Admin.News.AddEdit.NewsCategory"), data_e2e="NewsCategory" })
                                    </div>
                                </div>
                            </div>
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="row category-row middle-xs">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="AddingDates" class="form-label-block control-label">@T("Admin.News.AddEdit.Date")</label>
                                    </div>
                                    <div class="col-xs-12 col-md-4 col-md-4 col-lg-3 col-wl-2">
                                        <div class="input-group" ng-flatpickr fp-opts="{dateFormat: 'd.m.Y H:i', startDateFormat:'Y-m-dTH:i', wrap: true, enableTime: true}">
                                            <span class="flatpickr-custom-wrap @(isMobile ? "flex-grow" : "")">
                                                <input type="text" id="AddingDates" name="AddingDates" class="form-control input-alt-mobile input-alt" ng-flatpickr-input ng-init="newsItem.addingDates='@Model.AddingDate.ToString("yyyy-MM-ddTHH:mm:ss")'" ng-model="newsItem.addingDates" value="@Model.AddingDate.ToString("yyyy-MM-ddTHH:mm:ss")" data-e2e="NewsAddingDate">
                                                <span class="flatpickr-custom-clear" data-close data-clear>
                                                    <i class="fas fa-times"></i>
                                                </span>
                                            </span>
                                            <span class="input-group-addon" data-toggle>
                                                <i class="fas fa-calendar-alt"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* Description *@
            <div class="row setting">
                <div class="flex-grow-n @(isMobile ? "col-xs-12" : "col-fixed-size-md")">
                    <h2 class="fs-lg setting__subtitle">@T("Admin.News.AddEdit.Text")</h2>
                    <div class="">
                    </div>
                </div>
                <div class="flex-grow flex-basis-n flex-width-n">
                    <div class="ibox category-block">
                        <div class="ibox-content category-content border_none">
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="row category-row form-group setting__form-group">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="Description" class="form-label-block control-label">
                                            <span class="text-required">@T("Admin.News.AddEdit.Annotation")</span>
                                        </label>
                                    </div>
                                    <div class="col-xs-12 col-md-10">
                                        @Html.TextAreaFor(x => x.TextAnnotation, new { @class = "wysiwyg input-alt-mobile", ckeditor = "", ng_model = "newsItem.textAnnotation", required = "required", validation_input_text = T("Admin.News.AddEdit.Annotation"), data_e2e="NewsAnnotation" })
                                    </div>
                                </div>
                            </div>
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="row category-row form-group setting__form-group">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="Description" class="form-label-block m-b-wl control-label">
                                            <span class="text-required">@T("Admin.News.AddEdit.Text")</span>
                                        </label>
                                    </div>
                                    <div class="col-xs-12 col-md-10">
                                        @Html.TextAreaFor(x => x.TextToPublication, new { @class = "wysiwyg input-alt-mobile", ckeditor = "", ng_model = "newsItem.textToPublication", required = "required", validation_input_text = T("Admin.News.AddEdit.Text"), data_e2e="NewsText" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* Pictures *@
            <div class="row settings">
                <div class="flex-grow-n @(isMobile ? "col-xs-12" : "col-fixed-size-md")">
                    <h2 class="fs-lg setting__subtitle">@T("Admin.News.AddEdit.Pictures")</h2>
                </div>
                <div class="flex-grow flex-basis-n flex-width-n setting__form-group">
                    <div class="ibox category-block">
                        <div class="ibox-content category-content border_none">
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="row category-row">
                                    <div class="col-xs-12 col-md-2 control-label">
                                        @T("Admin.Category.Index.Picture")
                                        <div style="@(isMobile ? "font-weight:400;" : "")">
                                            @(SettingsPictureSize.NewsImageWidth)x@(SettingsPictureSize.NewsImageHeight)px
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-5">

                                        @Html.PictureUploader(AdvantShop.Catalog.PhotoType.News, Model.NewsId, Model.PhotoSrc, "newsItem.changePhoto(result)", new { data_e2e="NewsPicture" }, Model.PhotoId)

                                        @Html.HiddenFor(x => x.PhotoId, new { ng_value = "newsItem.PhotoId" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* News products *@
            <div class="row setting__form-group">
                <div class="flex-grow-n @(isMobile ? "col-xs-12" : "col-fixed-size-md")">
                    <h2 class="fs-lg  setting__subtitle">@T("Admin.News.AddEdit.GoodsInNews")</h2>
                </div>
                <div class="flex-grow flex-basis-n flex-width-n col-xs-12">
                    <div class="ibox category-block">
                        <div class="ibox-content category-content border_none">
                            <div class="@(!isMobile ? "container-fluid" : "")">
                                <div class="form-group middle-xs row setting__form-group">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="ProductsDisplayMode" class="form-label-block control-label">
                                            <span>@T("Admin.News.AddEdit.ProductsDisplayMode")</span>
                                        </label>
                                    </div>
                                    <div class="col-xs-12 col-md-3 col-wl-2 relative">
                                        <div class="form-control-wrap">
                                            @Html.DropDownListFor(x => x.ProductsDisplayMode, Model.ProductsDisplayMods, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.ProductsDisplayMode", ng_init = "newsItem.ProductsDisplayMode='" + Model.ProductsDisplayMode + "'", required = "required", validation_input_text = T("Admin.News.AddEdit.ProductsDisplayMode"), data_e2e="ProductsDisplayMode" })
                                            <help-trigger class="ng-cloak help-trigger-icon-abs m-l-xs @(isMobile ? "m-l-xs p-l-sm" : "")" data-title="@T("Admin.News.AddEdit.ProductsDisplayMode")">
                                                <div class="help-content">
                                                    @T("Admin.News.AddEdit.ProductsDisplayMode.HelpDiscription")
                                                </div>
                                            </help-trigger>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row category-row">
                                <div class="col-xs-12" ng-init="newsItem.productIds=[@Model.ProductIds.AggregateString(",")]">
                                    <news-products data-news-id="@Model.NewsId" data-product-ids="newsItem.productIds" data-e2e="NewsProducts"></news-products>
                                    <input name="productIds[{{$index}}]" ng-value="productId" type="hidden" ng-repeat="productId in newsItem.productIds">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* SEO*@
            <div class="row setting">
                <div class="flex-grow-n @(isMobile ? "col-xs-12" : "col-fixed-size-md")">
                    <h2 class="fs-lg setting__subtitle">SEO</h2>
                    <div class="m-b-sm setting__form-group">
                        @T("Admin.News.AddEdit.SeoParametersAutomaticallyFilled")
                    </div>
                </div>
                <div class="flex-grow flex-basis-n flex-width-n col-xs-12">
                    <div class="ibox brand-block">
                        <div class="ibox-content brand-content border_none">

                            <div>
                                <div class="row category-row form-group setting__form-group">
                                    <div class="col-xs-12 col-md-2">
                                        <label for="URL" class="form-label-block control-label">
                                            <span class="text-required">@T("Admin.News.AddEdit.Synonym")</span>
                                        </label>
                                    </div>
                                    @if (isMobile)
                                    {
                                        <div class="col-xs-12">
                                            <div class=" @(isMobile ? "card card--form-control" : "")" style="margin-bottom:0;">
                                                <label for="UrlPath" class="@(isMobile ? "card__label" : "input-group")" style="font-weight:400;">
                                                    <span class="@(isMobile ? "m-b-xs block" : "input-group-addon")"> @(SettingsMain.SiteUrl)/news/</span>
                                                </label>
                                                @Html.TextBoxFor(x => x.UrlPath, new { @class = "form-control card__input input-alt-mobile", ng_model = "newsItem.UrlPath", id = "URL", required = "required", validation_input_text = T("Admin.News.AddEdit.Synonym"), data_e2e="NewsUrlPath" })
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-xs-10">
                                            <label class="input-group form-label-block">
                                                <span class="input-group-addon fs-xs input-alt-mobile">@(SettingsMain.SiteUrl)/news/</span>
                                                @Html.TextBoxFor(x => x.UrlPath, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.UrlPath", id = "URL", required = "required", validation_input_text = T("Admin.News.AddEdit.Synonym"), data_e2e="NewsUrlPath" })
                                            </label>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="row setting__form-group">
                                <div class="control-label @(!isMobile ? "m-b-sm col-sm-offset-2" : "setting--m-b-none col-xs-12")">
                                    <label class="adv-checkbox-label" data-e2e="NewsDefaultMetaLbl">
                                        @Html.CheckBoxFor(x => x.DefaultMeta, new { ng_model = "newsItem.defaultMeta", ng_init = "newsItem.defaultMeta=" + Model.DefaultMeta.ToString().ToLower(), @class = "adv-checkbox-input", data_e2e="NewsDefaultMetaChb" })
                                        <span class="adv-checkbox-emul"></span>
                                        <span class="@(isMobile ? "m-l-xs" : "")">@T("Admin.News.AddEdit.UseDefaultMeta")</span>
                                    </label>
                                </div>
                            </div>
                            <div class="brand-seo-custom-block ng-cloak" ng-if="!newsItem.defaultMeta">
                                <div>
                                    <div class="row category-row form-group middle-xs setting__form-group">
                                        <div class="col-xs-12 col-md-2">
                                            <label class="form-label-block text-required control-label" for="SeoTitle">@T("Admin.Category.Index.SeoTitle")</label>
                                        </div>
                                        <div class="col-xs-12 col-md-10">
                                            @Html.TextBoxFor(x => x.SeoTitle, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.seoTitle", textcomplete = "", textcomplete_data = Html.Action("MetaVariablesComplete", "Common", new { type = AdvantShop.SEO.MetaType.News }), required = "required", validation_input_text = T("Admin.Category.Index.SeoTitle"), data_e2e="NewsMetaTitle" })
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="row category-row form-group middle-xs setting__form-group">
                                        <div class="col-xs-12 col-md-2">
                                            <label class="form-label-block text-required control-label" for="SeoH1">@T("Admin.Category.Index.SeoH1")</label>
                                        </div>
                                        <div class="col-xs-12 col-md-10">
                                            @Html.TextBoxFor(x => x.SeoH1, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.seoH1", textcomplete = "", textcomplete_data = Html.Action("MetaVariablesComplete", "Common", new { type = AdvantShop.SEO.MetaType.News }), required = "required", validation_input_text = T("Admin.Category.Index.SeoH1"), data_e2e="NewsMetaH1" })
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="row category-row form-group middle-xs setting__form-group">
                                        <div class="col-xs-12 col-md-2">
                                            <label class="form-label-block control-label" for="SeoKeywords">@T("Admin.Category.Index.SeoKeywords")</label>
                                        </div>
                                        <div class="col-xs-12 col-md-10">
                                            @Html.TextAreaFor(x => x.SeoKeywords, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.seoKeywords", textcomplete = "", textcomplete_data = Html.Action("MetaVariablesComplete", "Common", new { type = AdvantShop.SEO.MetaType.News }), data_e2e="NewsMetaKey" })
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="row category-row form-group middle-xs setting__form-group">
                                        <div class="col-xs-12 col-md-2">
                                            <label class="form-label-block control-label" for="SeoDescription">@T("Admin.Category.Index.SeoDescription")</label>
                                        </div>
                                        <div class="col-xs-12 col-md-10">
                                            @Html.TextAreaFor(x => x.SeoDescription, new { @class = "form-control input-alt-mobile", ng_model = "newsItem.seoDescription", textcomplete = "", textcomplete_data = Html.Action("MetaVariablesComplete", "Common", new { type = AdvantShop.SEO.MetaType.News }), data_e2e="NewsMetaDesc" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-md-offset-2">
                                        @Html.Action("MetaVariablesDescription", "Common", new { type = AdvantShop.SEO.MetaType.News })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>