<form is-mobile novalidate>
    <div class="modal-header">
        <ui-modal-cross ng-if="!isMobile.value"></ui-modal-cross>
        <h2 class="modal-header-title">{{'Admin.Js.AdditionBonus.AccrueAdditionalBonuses'|translate}}</h2>
    </div>
    <div class="modal-body">
        <div class="form-horizontal" ng-if="!ctrl.isStartExport" ng-class="{'m-r m-l' : !isMobile.value}">
            <div class="form-group setting__form-group">
                <div class="row">
                    <div class="col-xs-12 col-md-5">
                        <label class="control-label m-b-xs"> {{'Admin.Js.AdditionBonus.Name'|translate}} </label>
                    </div>
                    <div class="col-xs-12 col-md-7">
                        <input
                            type="text"
                            class="form-control input-alt"
                            ng-disabled="ctrl.isStartExport"
                            ng-model="ctrl.name"
                            data-autofocus="!isMobile.value"
                            data-e2e="Name" />
                    </div>
                </div>
            </div>
            <div class="form-group setting__form-group">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row form-group">
                            <div class="col-xs-12 col-md-5">
                                <label class="control-label m-b-xs"> {{'Admin.Js.AdditionBonus.ValidFrom'|translate}} </label>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="input-group" ng-flatpickr fp-opts="{dateFormat: 'd.m.Y', startDateFormat: 'Y-m-d', wrap: true}">
                                    <span class="flatpickr-custom-wrap" ng-class="{'flex-grow' : isMobile.value}">
                                        <input
                                            data-e2e="addAdditionBonusStartDate"
                                            class="form-control input-alt"
                                            ng-flatpickr-input
                                            ng-disabled="ctrl.isStartExport"
                                            ng-model="ctrl.startDate" />
                                        <span class="flatpickr-custom-clear" data-close data-clear><i class="fas fa-times"></i></span>
                                    </span>
                                    <span class="input-group-addon" data-toggle><i class="fas fa-calendar-alt"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-12 col-md-5">
                                <label class="control-label m-b-xs"> {{'Admin.Js.AdditionBonus.ValidInclusiveUpTo'|translate}} </label>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="input-group" ng-flatpickr fp-opts="{dateFormat: 'd.m.Y', startDateFormat: 'Y-m-d', wrap: true}">
                                    <span class="flatpickr-custom-wrap" ng-class="{'flex-grow' : isMobile.value}">
                                        <input
                                            data-e2e="addAdditionBonusEndDate"
                                            type="text"
                                            class="form-control input-alt"
                                            ng-flatpickr-input
                                            ng-disabled="ctrl.isStartExport"
                                            ng-model="ctrl.endDate" />
                                        <span class="flatpickr-custom-clear" data-close data-clear><i class="fas fa-times"></i></span>
                                    </span>
                                    <span class="input-group-addon" data-toggle><i class="fas fa-calendar-alt"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group setting__form-group">
                <div class="row">
                    <div class="col-xs-12 col-md-5">
                        <label class="control-label m-b-xs">
                            <span class="text-required">{{'Admin.Js.AdditionBonus.BonusAmount'|translate}}</span>
                        </label>
                    </div>
                    <div class="col-xs-12 col-md-7">
                        <input
                            type="text"
                            class="form-control input-alt"
                            ng-model="ctrl.amount"
                            required
                            validation-input-text="{{'Admin.Js.AdditionBonus.BonusAmount'|translate}}"
                            data-e2e="Amount" />
                    </div>
                </div>
            </div>
            <div class="form-group setting__form-group">
                <div class="row">
                    <div class="col-xs-12 col-md-5">
                        <label class="control-label m-b-xs"> {{'Admin.Js.AdditionBonus.Base'|translate}} </label>
                    </div>
                    <div class="col-xs-12 col-md-7">
                        <input
                            type="text"
                            class="form-control input-alt"
                            ng-model="ctrl.reason"
                            validation-input-text="{{'Admin.Js.AdditionBonus.Base'|translate}}"
                            data-e2e="Reason" />
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="middle-xs" ng-class="{'flex' : isMobile.value, 'row': !isMobile.value}">
                    <div ng-class="{'flex-grow' : isMobile.value, 'col-xs col-sm-5': !isMobile.value}">
                        <label class="control-label" ng-class="{'m-b-xs': !isMobile.value,'setting--m-none' : isMobile.value}">
                            {{'Admin.Js.Bonus.SendSms'|translate}}
                        </label>
                    </div>
                    <label
                        ng-class="{'adv-checkbox-label adv-checkbox-label--switch-on-off-wrapper' : isMobile.value, 'col-xs-4 col-sm-7': !isMobile.value}">
                        <switch-on-off
                            checked="ctrl.SendSms"
                            data-id="SendSms"
                            readonly="ctrl.isStartExport"
                            on-change="ctrl.onChangeSwitch(checked)"></switch-on-off>
                    </label>
                </div>
            </div>
            <div class="form-group setting__form-group" ng-show="false">
                <div class="row">
                    <div class="col-xs-12 col-md-5">
                        <label class="control-label m-b-xs"> Идентификатор задачи </label>
                    </div>
                    <div class="col-xs-12 col-md-7">
                        <input type="text" class="form-control input-alt" ng-disabled="ctrl.isStartExport" ng-model="ctrl.idempotenceKey" />
                    </div>
                </div>
            </div>
        </div>
        <cm-stat ng-if="ctrl.isStartExport" data-on-finish="cmStat.deleteObsevarable()" on-tick="ctrl.onTick(data)">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-xs-12">
                            <uib-progressbar max="cmStat.entity.Total" value="cmStat.entity.Processed"
                                ><span style="color: white; white-space: nowrap">{{cmStat.entity.ProcessedPercent }} %</span></uib-progressbar
                            >
                        </div>
                        <div class="col-xs-12" ng-if="ctrl.showReloadMassAddBtn">
                            <div>
                                <p>В процессе начисления бонусов возникла ошибка и начисление было прервано.</p>
                                <p>
                                    Вы можете нажать "Повторить" для повторного запуска начисления. При этом карты, которым уже были начислены бонусы,
                                    будут пропущены.
                                </p>
                                <p>Важно: если закрыть это окно, то такая возможно будет утеряна!</p>
                            </div>
                            <button
                                class="btn btn-save btn-success"
                                type="submit"
                                ng-click="ctrl.reloadProgressbar()"
                                button-validation
                                button-validation-success="ctrl.addBonus();"
                                ladda="ctrl.btnLoading"
                                data-e2e="bonusAdd">
                                Повторить
                            </button>
                        </div>
                    </div>

                    <div class="row" ng-if="!cmStat.entity.IsRun" ng-class="{'m-t-sm' : isMobile.value}">
                        <div class="col-xs-12 col-md-6">
                            <div class="form-group row" ng-if="cmStat.entity.Error == 0">
                                <div class="col-xs-12">
                                    <div class="setting-label-wrap">{{'Admin.Js.AdditionBonus.Completed'|translate}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </cm-stat>
    </div>
    <div class="modal-footer">
        <button
            ng-if="!ctrl.isProgressbarFinish"
            class="btn btn-save btn-primary"
            type="submit"
            button-validation
            button-validation-success="ctrl.addBonus();"
            ladda="ctrl.btnLoading"
            data-e2e="bonusAdd">
            {{'Admin.Js.AdditionBonus.Add'|translate}}
        </button>
        <button ng-if="!ctrl.isProgressbarFinish" class="btn btn-default btn-cancel" type="button" ng-click="ctrl.close()">
            {{'Admin.Js.AdditionBonus.Cancel'|translate}}
        </button>
        <button ng-if="ctrl.isProgressbarFinish" class="btn btn-default btn-cancel" type="button" ng-click="ctrl.close()">Закрыть</button>
    </div>
</form>
